# Releasing Flow

## Versioning

Flow uses [Semantic Versioning](https://semver.org): `MAJOR.MINOR.PATCH`

- **PATCH** — fixes to existing commands, wording corrections
- **MINOR** — new commands, new params fields, backwards-compatible changes
- **MAJOR** — breaking changes to workflow structure or params schema

The single source of truth is `SPECS/VERSION`. Each command file also carries a matching `**Version:**` header — update both when releasing. The install script copies `SPECS/VERSION` into the target repo so users can always check which version of Flow they have installed.


## Self-Hosted Development Policy

When Flow is used to develop Flow itself, keep active workflow files in-repo (single-branch model), but treat release packaging as a strict allowlist.

- Shipped in release zip (via `release-manifest.txt`): `install.sh`, `SPECS/VERSION`, `SPECS/COMMANDS/**`
- Never shipped in release zip: `SPECS/Workplan.md`, `SPECS/INPROGRESS/**`, `SPECS/ARCHIVE/**`

Rationale and trade-offs are documented in `docs/Self_Hosted_Development_and_Release_Strategy.md`.

## Release Artifact

A tag release includes:

```
GitHub source archives (auto-generated by GitHub)
flow-v{VERSION}-minimal.zip (uploaded by workflow)
SHA256SUMS (uploaded by workflow)
```

`flow-v{VERSION}-minimal.zip` contains:

```
install.sh
SPECS/VERSION
SPECS/COMMANDS/
```

The installer supports this minimal bundle and generates starter user files when template files are not present.

`SHA256SUMS` uses standard `sha256sum` output format and includes a checksum entry for `flow-v{VERSION}-minimal.zip`.

## Release Process (Automated on Tag Push)

### 1. Bump the version

Update `SPECS/VERSION` and the `**Version:**` header in every `SPECS/COMMANDS/*.md` that changed.

### 2. Commit

```bash
git add SPECS/VERSION SPECS/COMMANDS/
git commit -m "Release v{VERSION}"
```

### 3. Tag

```bash
git tag v{VERSION}
git push origin main
git push origin v{VERSION}
```

### 4. Workflow publishes the release

On push of `v*` tags, `.github/workflows/release.yml` will:

- Build bundle strictly from `release-manifest.txt` using `scripts/build-release-bundle.sh`
- Verify policy constraints (required + forbidden paths) with `scripts/verify-release-bundle.sh`
- Generate `SHA256SUMS` for release assets
- Create the GitHub Release automatically (or update assets if the release already exists)
- Upload both artifacts to the release (`flow-v{VERSION}-minimal.zip`, `SHA256SUMS`)

## User Installation

```bash
# Download minimal release artifact from GitHub Release assets
curl -sSL -o flow.zip https://github.com/SoundBlaster/Flow/releases/download/v{VERSION}/flow-v{VERSION}-minimal.zip
curl -sSL -o SHA256SUMS https://github.com/SoundBlaster/Flow/releases/download/v{VERSION}/SHA256SUMS
grep " flow-v{VERSION}-minimal.zip$$" SHA256SUMS > flow.sum
shasum -a 256 -c flow.sum    # or: sha256sum -c flow.sum
unzip flow.zip
./flow-v{VERSION}-minimal/install.sh /path/to/repo

# Local (after cloning)
./install.sh /path/to/repo
```

## Checklist

- [ ] `SPECS/VERSION` updated
- [ ] Command file headers updated
- [ ] Commit and tag pushed
- [ ] GitHub Release created
- [ ] Release includes both `flow-v{VERSION}-minimal.zip` and `SHA256SUMS`

## Troubleshooting

- `SHA256SUMS` missing: release is incomplete; re-run the release workflow.
- Checksum mismatch: abort install, re-download assets, and verify you are using matching `v{VERSION}` URLs.
- `404` on assets: confirm the tag exists and the release is published (not draft).

## Future Enhancements (Deferred)

These are intentionally not in current scope:

- `install.sh --commands-only`
- `install.sh --dry-run`
- `install.sh --yes`

## Version Bump Automation for Consumer Repos

Use Renovate/Dependabot to update pinned `FLOW_VERSION` in consumer wrapper scripts and Make targets.

Recommended policy:

1. Bot opens PR with only version bump lines changed.
2. CI runs bootstrap + checksum verification.
3. Merge after checks pass.
